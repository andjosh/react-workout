<!DOCTYPE html>
<html>
  <head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-type" />
    <title>React Workout</title>
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <style type="text/css">
      body{
        margin:0 auto;
        max-width: 500px;
      }
      textarea{
        display: block;
      }
      #div{
      }
    </style>
  </head>
    <body>
        <h1 class="headline">
            React Workout
        </h1>
        <div id="div">
           <label for="scratch">Scratchpad
                <textarea name="scratch">
                    Anything you type here will show up upon your return 
                    (like your previous weights)
                </textarea>
            </label><br/>
            <label for="weight">Weight
                <input name="weight" type="number" value="0"></input>
            </label><br/>
            <label for="reps">Reps
                <input name="reps" type="number" value="0"></input>
            </label><br/>
            One Rep Max: <span name="orm">0</span><br/>
            <label for="week">Week
                <select name="week">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                </select>
            </label>
            <table name="weekTable">
                <caption>Week 1: <small>5 reps each</small></caption>
                <tr>
                    <th>60%</th>
                    <th>65%</th>
                    <th>75%</th>
                    <th>75%</th>
                </tr>
                <tr>
                    <td data-val="0.60">0</td>
                    <td data-val="0.65">0</td>
                    <td data-val="0.75">0</td>
                    <td data-val="0.75">0</td>
                </tr>
            </table>
        </div>

        <script 
            src="https://cdnjs.cloudflare.com/ajax/libs/react/0.13.1/react-with-addons.js">
        </script>
        <script 
            src="https://cdnjs.cloudflare.com/ajax/libs/react/0.13.1/JSXTransformer.js">
        </script>
        <script type="text/jsx">
            // make calculator fn
            // make weeks object
            // make cookie setter fn
            // make cookie getter fn
            // make input components
            // make week select component
            // make ORM component
            // make week table component
            var _workout = window._workout || {
                        elements:       {}
                    },
                ORM,
                Scratch,
                WorkoutForm,
                WeightInput,
                RepsInput,
                WeekSelect,
                WeekTable;

            WorkoutForm = React.createClass({
                getInitialState: function() {
                    return {
                        reps:   10,
                        weight: 0,
                        week:   1,
                        multi:  1,
                        orm:    0
                    }
                },
                calcORM: function(weight, reps, multi) {
                    weight = weight || this.state.weight;
                    reps = reps || this.state.reps;
                    multi = multi || this.state.multi;
                    this.setState({
                        weight: weight,
                        reps:   reps,
                        multi:  multi,
                        orm: _workout.calcOrm(
                                weight,
                                reps,
                                multi
                            )
                    });
                },
                render: function(){
                    return (
                        <div className="workout">
                            <RepsInput 
                                onChange={this.calcORM} 
                                value={this.state.reps}
                            />
                            <WeightInput 
                                onChange={this.calcORM} 
                                value={this.state.weight} 
                            />
                            <ORM 
                                max={this.state.orm} 
                            />
                        </div>
                    );
                }
            });
            RepsInput = React.createClass({
                getInitialState: function() {
                    return {
                        value:  this.props.value
                    };
                },
                handleChange: function(e) {
                    this.props.onChange(null, e.target.value);
                },
                render: function() {
                    return (
                        <label>
                            <span>Reps:</span>
                            <input 
                                type="number" 
                                name="reps" 
                                defaultValue={this.state.value} 
                                onChange={this.handleChange}
                            />
                        </label>
                    );
                }
            });
            WeightInput = React.createClass({
                getInitialState: function() {
                    return {
                        value:  this.props.value
                    };
                },
                handleChange: function(e) {
                    this.props.onChange(e.target.value);
                },
                render: function() {
                    return (
                        <label>
                            <span>Weight:</span>
                            <input 
                                type="number" 
                                name="weight" 
                                defaultValue={this.state.value} 
                                onChange={this.handleChange}
                            />
                        </label>
                    );
                }
            });
            ORM = React.createClass({
                render: function() {
                    return (
                        <p className="orm">
                            One Rep Max: {this.props.max}
                        </p>
                    );
                }
            });
            _workout.setCookie = function (cname, cvalue, exdays) {
                var d = new Date()
                    expires;

                exdays = exdays || 360;
                d.setTime(d.getTime() + (exdays*24*60*60*1000));
                expires = "expires="+d.toUTCString();
                document.cookie = cname + "=" + cvalue + "; " + expires;
            };
            _workout.getCookie = function (cname) {
                var name = cname + "=",
                    ca = document.cookie.split(';'),
                    c;

                for(var i=0; i<ca.length; i++) {
                    c = ca[i];
                    while (c.charAt(0)==' ') c = c.substring(1);
                    if (c.indexOf(name) === 0) return c.substring(name.length,c.length);
                }
                return "No cookie present";
            };
            _workout.calcOrm = function (w, r, multiplier){
                var base = Math.round(
                    (
                        w / (
                            1.0278 - ( 0.0278 * r) ) * 
                        multiplier
                    )
                );

                return base;
            };
            _workout.gogo = function (){
                _workout.elements = {
                    form:       React.createElement(WorkoutForm)
                };
                React.render(
                    _workout.elements.form,
                    document.getElementById('div')
                );
            }
            window.addEventListener('load', _workout.gogo);
        </script>
    </body>
</html>
